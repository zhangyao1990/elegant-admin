
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{a as d,c as f}from"./@vue-B5ZJ3lyG.js";const g=(t,s)=>{const i=t.__vccOpts||t;for(const[r,n]of s)i[r]=n;return i},m={props:{width:{type:Number,default:800},height:{type:Number,default:300},lineWidth:{type:Number,default:4},lineColor:{type:String,default:"#000000"},bgColor:{type:String,default:""},isCrop:{type:Boolean,default:!1},isClearBgColor:{type:Boolean,default:!0},format:{type:String,default:"image/png"},quality:{type:Number,default:1}},data(){return{hasDrew:!1,resultImg:"",points:[],canvasTxt:null,startX:0,startY:0,isDrawing:!1,sratio:1}},computed:{ratio(){return this.height/this.width},stageInfo(){return this.$refs.canvas.getBoundingClientRect()},myBg(){return this.bgColor?this.bgColor:"rgba(255, 255, 255, 0)"}},watch:{myBg:function(t){this.$refs.canvas.style.background=t}},beforeMount(){window.addEventListener("resize",this.$_resizeHandler)},beforeDestroy(){window.removeEventListener("resize",this.$_resizeHandler)},mounted(){const t=this.$refs.canvas;t.height=this.height,t.width=this.width,t.style.background=this.myBg,this.$_resizeHandler(),document.onmouseup=()=>{this.isDrawing=!1}},methods:{$_resizeHandler(){const t=this.$refs.canvas;t.style.width=this.width+"px";const s=parseFloat(window.getComputedStyle(t).width);t.style.height=this.ratio*s+"px",this.canvasTxt=t.getContext("2d"),this.canvasTxt.scale(1*this.sratio,1*this.sratio),this.sratio=s/this.width,this.canvasTxt.scale(1/this.sratio,1/this.sratio)},mouseDown(t){t=t||event,t.preventDefault(),this.isDrawing=!0,this.hasDrew=!0;let s={x:t.offsetX,y:t.offsetY};this.drawStart(s)},mouseMove(t){if(t=t||event,t.preventDefault(),this.isDrawing){let s={x:t.offsetX,y:t.offsetY};this.drawMove(s)}},mouseUp(t){t=t||event,t.preventDefault();let s={x:t.offsetX,y:t.offsetY};this.drawEnd(s),this.isDrawing=!1},touchStart(t){if(t=t||event,t.preventDefault(),this.hasDrew=!0,t.touches.length===1){let s={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawStart(s)}},touchMove(t){if(t=t||event,t.preventDefault(),t.touches.length===1){let s={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawMove(s)}},touchEnd(t){if(t=t||event,t.preventDefault(),t.touches.length===1){let s={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawEnd(s)}},drawStart(t){this.startX=t.x,this.startY=t.y,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)},drawMove(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.strokeStyle=this.lineColor,this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)},drawEnd(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t),this.points.push({x:-1,y:-1})},generate(t){let s=t&&t.format?t.format:this.format,i=t&&t.quality?t.quality:this.quality;return new Promise((n,e)=>{if(!this.hasDrew){e("Warning: Not Signned!");return}var a=this.canvasTxt.getImageData(0,0,this.$refs.canvas.width,this.$refs.canvas.height);this.canvasTxt.globalCompositeOperation="destination-over",this.canvasTxt.fillStyle=this.myBg,this.canvasTxt.fillRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.resultImg=this.$refs.canvas.toDataURL(s,i);var o=this.resultImg;if(this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.canvasTxt.putImageData(a,0,0),this.canvasTxt.globalCompositeOperation="source-over",this.isCrop){const l=this.getCropArea(a.data);var h=document.createElement("canvas");const c=h.getContext("2d");h.width=l[2]-l[0],h.height=l[3]-l[1];const v=this.canvasTxt.getImageData(...l);c.globalCompositeOperation="destination-over",c.putImageData(v,0,0),c.fillStyle=this.myBg,c.fillRect(0,0,h.width,h.height),o=h.toDataURL(s,i),h=null}n(o)})},reset(){this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.isClearBgColor&&(this.$emit("update:bgColor",""),this.$refs.canvas.style.background="rgba(255, 255, 255, 0)"),this.points=[],this.hasDrew=!1,this.resultImg=""},getCropArea(t){for(var s=this.$refs.canvas.width,i=0,r=this.$refs.canvas.height,n=0,e=0;e<this.$refs.canvas.width;e++)for(var a=0;a<this.$refs.canvas.height;a++){var o=(e+this.$refs.canvas.width*a)*4;(t[o]>0||t[o+1]>0||t[o+2]||t[o+3]>0)&&(n=Math.max(a,n),i=Math.max(e,i),r=Math.min(a,r),s=Math.min(e,s))}return s++,i++,r++,n++,[s,r,i,n]}}};function x(t,s,i,r,n,e){return d(),f("canvas",{ref:"canvas",onMousedown:s[0]||(s[0]=(...a)=>e.mouseDown&&e.mouseDown(...a)),onMousemove:s[1]||(s[1]=(...a)=>e.mouseMove&&e.mouseMove(...a)),onMouseup:s[2]||(s[2]=(...a)=>e.mouseUp&&e.mouseUp(...a)),onTouchstart:s[3]||(s[3]=(...a)=>e.touchStart&&e.touchStart(...a)),onTouchmove:s[4]||(s[4]=(...a)=>e.touchMove&&e.touchMove(...a)),onTouchend:s[5]||(s[5]=(...a)=>e.touchEnd&&e.touchEnd(...a))},null,544)}const u=g(m,[["render",x],["__scopeId","data-v-1fcc7cb1"]]);u.install=function(t){this.installed||(this.installed=!0,t.component("vueEsign",u))};export{g as _,u as v};
