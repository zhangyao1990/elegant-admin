
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{v as S}from"./index-qeCTDZwl.js";import{d as Y}from"./vuedraggable-CX4WvCQN.js";import{i as K,_ as Z,h as G,j as H}from"./index-CN3V1Hei.js";import{_ as D}from"./icon.vue_vue_type_script_setup_true_lang-Ct1VJFCF.js";import{d as M,i as B,r as E,w as T,a as v,c as _,a8 as J,f as d,Z as A,_ as V,k as g,U as F,X as Q,Y as P,F as U,b as O,V as q,$ as z,q as L,l as W,S as R,n as ee,af as X}from"./@vue-B5ZJ3lyG.js";import{_ as te}from"./tree.vue_vue_type_script_setup_true_lang-BY5vdYQE.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-CyY_Wk_H.js";import"./@imengyu-CEcZjhxx.js";import"./vue-DvVlWPqX.js";import"./floating-vue-AocVffS4.js";import"./@floating-ui-DiM7Jq06.js";import"./vue-m-message-CaZYo5LC.js";import"./overlayscrollbars-DIcyBJd7.js";import"./@iconify-BcJ8VpTk.js";import"./overlayscrollbars-vue-CwvYLriB.js";import"./@headlessui-Cgia3ZxR.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-0jcLrwUI.js";import"./lodash-es-Cgwu3vQX.js";import"./pinia-C6gN_FJk.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-B53joON4.js";import"./hotkeys-js-BfWqkGRU.js";import"./element-plus-iUOJk6xm.js";import"./@vueuse-D9pgrdqz.js";import"./nprogress-CK9xi7fq.js";import"./@element-plus-DlsPF3Ud.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-DHZ_rfNz.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./vue-i18n-BoS7Exf_.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-1i8roCpp.js";import"./path-browserify-CaPOtSVJ.js";import"./axios-CRnBnh7r.js";import"./sortablejs-BWWsmqBL.js";import"./vue-esign-CYl9_Ryz.js";const ne={class:"elegant-event-info"},oe=["title"],ae={class:"elegant-event-btn flex items-center text-lg text-$elegant-text-secondary"},le={class:"elegant-action-editor-main"},se={class:"elegant-editor-item rounded"},ie={class:"w-36px flex items-center text-lg"},de={class:"flex-1"},ce={key:0},ue={key:1},re={key:2},me={class:"elegant-action-box text-lg text-$elegant-text-medium"},pe=["onClick"],ve=["onClick"],fe=M({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>{}},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup($,{emit:b}){const r=$,x=b,I=B("pageSchema");function k(e){x("add",e)}function h(e){return K(I.schemas,e).label}function m(e,l){var f;const n=a(l);n[l]=r.events[l].filter((N,w)=>e!==w),(f=n[l])!=null&&f.length||delete n[l],x("update:modelValue",n)}function u(e,l,n){x("edit",e,l,n)}function a(e){const l={};return r.allEvents.forEach(n=>{if(!r.events[n.type].length||n.type===e)return!1;l[n.type]=r.events[n.type]}),l}const p=E(r.events);return T(()=>r.events,e=>{p.value=e},{deep:!0,immediate:!0}),(e,l)=>(v(!0),_(U,null,J($.itemEvents,n=>(v(),_("div",{key:n.type,class:"elegant-event-item"},[d("div",ne,[d("div",{class:"elegant-event-label",title:n.describe},A(n.describe),9,oe),d("div",ae,[V(g(D),{name:"icon--elegant--add-rounded",onClick:f=>k(n.type)},null,8,["onClick"])])]),d("div",le,[V(g(Y),{modelValue:g(p)[n.type],"onUpdate:modelValue":f=>g(p)[n.type]=f,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:F(({element:f,index:N})=>[d("div",se,[d("div",ie,[V(g(D),{class:"handle mr-2 cursor-move text-lg text-$elegant-text-medium",name:"icon--elegant--drag"})]),d("div",de,[f.type==="component"?(v(),_("div",ce,A(h(f.componentId)),1)):f.type==="custom"?(v(),_("div",ue," 自定义函数 ")):f.type==="public"?(v(),_("div",re," 公共函数 ")):Q("",!0),P(" "+A(f.methodName),1)]),d("div",me,[d("div",{class:"elegant-edit-btn",onClick:w=>u(N,n.type,f)},[V(g(D),{name:"icon--elegant--page-info-outline-rounded"})],8,pe),d("div",{class:"elegant-del-btn",onClick:w=>m(N,n.type)},[V(g(D),{name:"icon--elegant--delete-outline-rounded"})],8,ve)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),ge={class:"h-full flex flex-col"},he=M({__name:"EScriptEdit",setup($){const b=S.getComponent("monacoEditor"),r={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},x=E(null),I=B("pageSchema");return(k,h)=>(v(),_("div",ge,[h[1]||(h[1]=d("div",{class:"pb-2"}," 自定义函数编辑 ",-1)),V(g(b),{ref_key:"monacoEditorRef",ref:x,modelValue:g(I).script,"onUpdate:modelValue":h[0]||(h[0]=m=>g(I).script=m),"auto-toggle-theme":"",class:"elegant-editor flex-1",config:r,language:"javascript"},null,8,["modelValue"])]))}}),_e={class:"elegant-attribute-view"},ye=["title"],xe={class:"elegant-attr-input"},Ie=M({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup($,{emit:b}){const r=$,x=b,I=O(()=>r.modelValue?JSON.parse(r.modelValue):[]);function k(m){var u;return typeof m.show=="boolean"?m.show:typeof m.show=="function"?(u=m.show)==null?void 0:u.call(m,{values:I.value}):!0}function h(m,u){const a=[...JSON.parse(r.modelValue??"[]")];a[u]=m,x("update:modelValue",JSON.stringify(a))}return(m,u)=>(v(),_("div",_e,[(v(!0),_(U,null,J(r.actionArgsConfigs,a=>(v(),_("div",{key:a.field+a.type},[q(d("div",{class:L(["elegant-attr-item",a.layout])},[d("div",{class:"elegant-attr-label",title:a.label},A(a.label),9,ye),d("div",xe,[V(g(Z),{"component-schema":{...a,componentProps:{...a.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":I.value[a.field],"onUpdate:modelValue":p=>h(p,a.field)},null,8,["component-schema","model-value","onUpdate:modelValue"])])],2),[[z,k(a)]])]))),128))]))}}),Ce={class:"elegant-modal-action-main rounded"},Ve={class:"elegant-modal-left-panel h-full flex flex-col"},ke={class:"h-0 flex flex-1 flex-col"},be={class:"h-0 flex-1"},Ee={class:"elegant-action-select h-30/100 flex flex-col"},$e={class:"flex-1 overflow-auto pr-8px"},Ne=["onClick"],we={class:"pt-42px text-center text-gray-400"},Se={class:"elegant-modal-right-panel"},Oe={key:1,class:"pt-42px text-center text-gray-400"},Ae=M({__name:"EActionModal",emits:["add","edit"],setup($,{expose:b,emit:r}){const x=r,I=S.getComponent("modal"),k=E(!0),h=B("pageSchema"),m=B("pageManager",{}),u=E(!1),a=E([]),p=E(null),e=W({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}}),l=O(()=>{var o;return e.actionItem.type==="component"?p.value?(o=S.getComponentConfings()[p.value.type].config.action)==null?void 0:o.map(t=>({label:t.describe,value:t.type})):[]:e.actionItem.type==="custom"?Object.entries(m.funcs.value).filter(([t,C])=>typeof C=="function").map(([t])=>({label:t,value:t})):e.actionItem.type==="public"?Object.entries(S.publicMethods).map(([t])=>({label:t,value:t})):[]}),n=O(()=>{if(e.actionItem.type==="component"&&p.value){const o=S.getComponentConfings()[p.value.type].config.action,t=o==null?void 0:o.find(C=>C.type===e.actionItem.methodName);if(t!=null&&t.argsConfigs){const C=t.argsConfigs.findIndex(y=>y.label==="设置数据");C!==-1&&(t.argsConfigs[C]={...p.value,label:"设置数据",field:"0",id:G()})}return(t==null?void 0:t.argsConfigs)??[]}return[]});function f(){var o;u.value=!0,k.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(o=l.value)!=null&&o.length&&c(l.value[0].value)}function N(o){u.value=!0,k.value=!1,p.value=null,o.componentId&&(p.value=K(h.schemas,o.componentId),a.value=[o.componentId]),ee(()=>{e.actionItem.componentId=o.componentId,e.actionItem.methodName=o.methodName,e.actionItem.type=o.type,e.actionItem.args=o.args})}function w(){if(!e.actionItem.methodName){alert("请先选择动作方法");return}x(k.value?"add":"edit",H(X(e.actionItem))),j()}function j(){u.value=!1,a.value=[],e.cacheData={}}function i(o){var t;e.actionItem.componentId=null,e.actionItem.type=o,p.value=null,e.actionItem.methodName=null,a.value=[],(t=l.value)!=null&&t.length&&c(l.value[0].value)}function s(o){var t;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=o.id,e.actionItem.type="component",e.actionItem.methodName=null,p.value=o.componentSchema,(t=l.value)!=null&&t.length&&c(l.value[0].value)}function c(o){e.actionItem.methodName=o,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return b({handleOpen:f,handleOpenEdit:N}),(o,t)=>(v(),R(g(I),{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=C=>u.value=C),class:"w-1200px",width:"1200px",title:"动作配置",onClose:j,onOk:w},{default:F(()=>{var C;return[d("div",Ce,[d("div",Ve,[d("div",ke,[d("div",{class:L(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:t[0]||(t[0]=y=>i("custom"))}," 自定义函数 ",2),d("div",{class:L(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:t[1]||(t[1]=y=>i("public"))}," 公共函数 ",2),t[5]||(t[5]=P(" 组件 ")),d("div",be,[V(g(te),{"selected-keys":a.value,"onUpdate:selectedKeys":t[2]||(t[2]=y=>a.value=y),options:g(h).schemas,onNodeClick:s},null,8,["selected-keys","options"])])]),d("div",Ee,[t[6]||(t[6]=d("div",{class:"mb-2"}," 动作选择 ",-1)),d("div",$e,[(v(!0),_(U,null,J(l.value,y=>(v(),_("div",{key:y.value,class:L([{checked:y.value===e.actionItem.methodName},"elegant-action-item"]),onClick:Ue=>c(y.value)},[d("span",null,A(y.label),1)],10,Ne))),128)),q(d("div",we," 当前组件暂无动作 ",512),[[z,!((C=l.value)!=null&&C.length)]])])])]),d("div",Se,[e.actionItem.type==="custom"?(v(),R(he,{key:0})):n.value.length===0?(v(),_("div",Oe," 暂无配置 ")):(v(),R(Ie,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":t[3]||(t[3]=y=>e.actionItem.args=y),"action-args-configs":n.value},null,8,["modelValue","action-args-configs"]))])])]}),_:1},8,["modelValue"]))}}),Ct=M({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup($,{emit:b}){const r=$,x=b,I=S.getComponent("Collapse"),k=S.getComponent("CollapseItem"),h=E(null);let m=0;const u=O({get(){return r.modelValue},set(i){x("update:modelValue",i)}}),a=E([]),p=O(()=>r.eventList.filter(i=>i.events.length)),e=O(()=>r.eventList.map(i=>i.events).flat()),l=E({});e.value.forEach(i=>{l.value[i.type]=O({get(){var s;return((s=u.value)==null?void 0:s[i.type])??[]},set(s){s&&s.length?u.value[i.type]=s.map(c=>X(c)):delete u.value[i.type]}})}),T(()=>p.value,i=>{i.length&&(a.value=i.filter(s=>{for(let c=0;c<s.events.length;c++){const o=s.events[c].type;if(l.value[o].length)return!0}return!1}).map(s=>s.title))},{immediate:!0});let n="";function f(i){var s;(s=h.value)==null||s.handleOpen(),n=i}function N(i,s,c){var o;(o=h.value)==null||o.handleOpenEdit(c),m=i,n=s}function w(i){l.value[n][m]=i,u.value[n]=[...l.value[n]??[]]}function j(i){if(!u.value){u.value={[n]:[...l.value[n]??[],i]};return}u.value[n]=[...l.value[n]??[],i]}return(i,s)=>(v(),_(U,null,[V(g(I),{modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=c=>a.value=c),"active-key":a.value,"onUpdate:activeKey":s[2]||(s[2]=c=>a.value=c),"expanded-names":a.value,"onUpdate:expandedNames":s[3]||(s[3]=c=>a.value=c)},{default:F(()=>[(v(!0),_(U,null,J(p.value,c=>(v(),R(g(k),{key:c.title,title:c.title,header:c.title,name:c.title},{default:F(()=>[V(fe,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=o=>u.value=o),"item-events":c.events,"all-events":e.value,events:l.value,onAdd:f,onEdit:N},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","active-key","expanded-names"]),V(Ae,{ref_key:"EActionModalRef",ref:h,onAdd:j,onEdit:w},null,512)],64))}});export{Ct as default};
