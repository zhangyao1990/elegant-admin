
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{r as h,o as I,v as O,d as X,bK as Y,b as M,p as Z,ai as U,a as j,c as z,f as N,N as F,_ as f,U as w,k as a,Z as q,E as k}from"./@vue-B5ZJ3lyG.js";import{B as K,A as G}from"./@element-plus-DlsPF3Ud.js";import{_ as H}from"./TreeNode.vue_vue_type_script_setup_true_name_TreeNode_lang-CFsi_M6S.js";import J from"./index-BppX8QWt.js";import{_ as Q}from"./vue-esign-CYl9_Ryz.js";import"./StartNode-DwEch3Ku.js";import"./Node-DguPqMLY.js";import"./index-qeCTDZwl.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-CyY_Wk_H.js";import"./@imengyu-CEcZjhxx.js";import"./vue-DvVlWPqX.js";import"./floating-vue-AocVffS4.js";import"./@floating-ui-DiM7Jq06.js";import"./vue-m-message-CaZYo5LC.js";import"./overlayscrollbars-DIcyBJd7.js";import"./@iconify-BcJ8VpTk.js";import"./overlayscrollbars-vue-CwvYLriB.js";import"./@headlessui-Cgia3ZxR.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-0jcLrwUI.js";import"./lodash-es-Cgwu3vQX.js";import"./pinia-C6gN_FJk.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-B53joON4.js";import"./hotkeys-js-BfWqkGRU.js";import"./element-plus-iUOJk6xm.js";import"./@vueuse-D9pgrdqz.js";import"./nprogress-CK9xi7fq.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-DHZ_rfNz.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./vue-i18n-BoS7Exf_.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-1i8roCpp.js";import"./path-browserify-CaPOtSVJ.js";import"./axios-CRnBnh7r.js";import"./Add-C58AJOfu.js";import"./EndNode-vm63MGZm.js";import"./ApprovalNode.vue_vue_type_script_setup_true_lang-C8aUlEO2.js";import"./CcNode.vue_vue_type_script_setup_true_lang-DhRNebTV.js";import"./TimerNode.vue_vue_type_script_setup_true_lang-BjlmaDHj.js";import"./NotifyNode.vue_vue_type_script_setup_true_lang-D7g4j9Hn.js";import"./ConditionNode-BcscuMpI.js";import"./StartPanel-DjOOvegT.js";import"./ExecutionListeners-DDiw2FTE.js";import"./ApprovalPanel-DwytY9C_.js";import"./index-DCl_rd1q.js";import"./UserTag-wJe9SfQr.js";import"./UserPicker-xx7XSXa5.js";import"./sys_user-rXWpRg4F.js";import"./AssigneePanel.vue_vue_type_script_setup_true_lang-DK6I14do.js";import"./index-bQqCd7I9.js";import"./RoleTag-BaAFCPzf.js";import"./RolePicker-CL6w3CbS.js";import"./sys_role-CiNVMn25.js";import"./TaskListeners-DUaA8Id2.js";import"./CcPanel-DmBNRnZ-.js";import"./TimerPanel.vue_vue_type_script_setup_true_lang-CwZuTETV.js";import"./NotifyPanel.vue_vue_type_script_setup_true_lang-BUXNDz5c.js";import"./ConditionPanel.vue_vue_type_script_setup_true_lang-vj94MXHE.js";import"./index-c4LDtQjF.js";import"./Trigger.vue_vue_type_script_setup_true_lang-C_oW-5cy.js";import"./Operator-CoXpKcBT.js";import"./EndPanel.vue_vue_type_script_setup_true_lang-BZ05Ww9G.js";function W(l){const u=h(!1);let d,v,s,g;const b=r=>{l.value&&(u.value=!0,d=r.pageX,v=r.pageY,s=l.value.scrollLeft,g=l.value.scrollTop,document.addEventListener("mousemove",c),document.addEventListener("mouseup",p))},c=r=>{if(!u.value||!l.value)return;const y=r.pageX-d,E=r.pageY-v;l.value.scrollLeft=s-y,l.value.scrollTop=g-E},p=()=>{u.value=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",p)};return I(()=>{var r;(r=l.value)==null||r.addEventListener("mousedown",b)}),O(()=>{var r;(r=l.value)==null||r.removeEventListener("mousedown",b)}),{isDragging:u}}const R={class:"tool"},ee={class:"zoom"},oe={class:"node-container"},ie=X({__name:"index",props:{process:{},fields:{},readOnly:{type:Boolean,default:!1},defaultZoom:{default:100},bgColor:{default:"var(--el-bg-color-page)"}},setup(l,{expose:u}){Y(o=>({"7b42e429":o.bgColor,"467cba2e":a(g)}));const d=l,v=M(()=>{const o=[],e=i=>{i.forEach(t=>{t.type==="formItem"&&o.push(t),Array.isArray(t.children)&&e(t.children)})};return e(d.fields),o}),s=h(d.defaultZoom),g=M(()=>s.value/100),b=M(()=>d.readOnly),c=h({id:"",name:"",type:"start"}),p=h(!1),r=h({}),y=h(null);W(y),Z("flowDesign",{readOnly:b,fields:v,nodesError:r});function E(o){c.value=o,p.value=!0}function m(){let o=`node_${Math.random().toString(36).substring(2,7)}`;const e=(i,t)=>{if(i.id===t)return!0;if(i.child)return e(i.child,t);if("children"in i){const n=i;if(n.children&&n.children.length>0)return n.children.some(D=>e(D,t))}return!1};return e(d.process,o)?m():o}function B(o){const e=o.child,i=m(),t={id:i,pid:o.id,type:"exclusive",name:"独占网关",child:e,children:[]};if(e&&(e.pid=i),L(t),L(t),o.child=t,t.children.length>0){const n=t.children[t.children.length-1];n.def=!0,n.name="默认条件"}}function L(o){const e=o;e.children.splice(e.children.length-1,0,{id:m(),pid:e.id,type:"condition",def:!1,name:`条件${e.children.length+1}`,conditions:{operator:"and",conditions:[],groups:[]},child:void 0})}function P(o){const e=o.child,i=m();o.child={id:i,pid:o.id,type:"cc",name:"抄送人",child:e,assigneeType:"user",formUser:"",formRole:"",users:[],roles:[],leader:1,orgLeader:1,choice:!1,self:!1,formProperties:[]},e&&(e.pid=i)}function V(o){const e=o.child,i=m();o.child={id:i,pid:o.id,name:"计时等待",type:"timer",child:e,waitType:"duration",unit:"PT%sS",duration:0,timeDate:void 0},e&&(e.pid=i)}function x(o){const e=o.child,i=m();o.child={id:i,pid:o.id,name:"消息通知",type:"notify",child:e,assigneeType:"user",formUser:"",formRole:"",users:[],roles:[],leader:1,orgLeader:1,choice:!1,self:!1,types:["site"],subject:"",content:""},e&&(e.pid=i)}function A(o){const e=o.child,i=m();o.child={id:i,pid:o.id,type:"approval",name:"审批人",executionListeners:[],child:e,assigneeType:"user",formUser:"",formRole:"",users:[],roles:[],leader:1,orgLeader:1,choice:!1,self:!1,multi:"sequential",multiPercent:100,nobody:"pass",nobodyUsers:[],formProperties:[],operations:{complete:!0,refuse:!0,back:!0,transfer:!0,delegate:!0,addMulti:!1,minusMulti:!1}},e&&(e.pid=i)}function S(o,e){const t={exclusive:B,condition:L,cc:P,timer:V,notify:x,approval:A}[o];t&&t(e)}function T(o){delete r.value[o.id],C(d.process,o)}function C(o,e){var i;if(delete r.value[e.id],o.id===e.pid)if("children"in o&&((i=o.child)==null?void 0:i.id)!==e.id){const t=o,n=t.children.findIndex(D=>D.id===e.id);n!==-1&&(t.children.length<=2?(_(t),T(t)):(_(e),t.children.splice(n,1)))}else e.child&&e.child.pid&&(e.child.pid=o.id),o.child=e.child;else if(o.child&&C(o.child,e),"children"in o){const t=o;t.children&&t.children.length>0&&t.children.forEach(n=>{C(n,e)})}}function _(o){if(delete r.value[o.id],o.child&&_(o.child),"children"in o){const e=o;e.children&&e.children.length>0&&e.children.forEach(i=>{_(i)})}}function $(){return new Promise((o,e)=>{const i=Object.values(r.value).flat();i.length>0?e(i):o(!0)})}return u({validate:$}),(o,e)=>{const i=U("el-button"),t=U("el-tooltip");return j(),z("div",{ref_key:"designerContainerRef",ref:y,class:"designer-container cursor-default active:cursor-grabbing"},[N("div",R,[F(o.$slots,"default",{},void 0,!0)]),N("div",ee,[f(t,{content:"放大",placement:"bottom"},{default:w(()=>[f(i,{icon:a(K),disabled:a(s)>=170,circle:"",onClick:e[0]||(e[0]=n=>s.value+=10)},null,8,["icon","disabled"])]),_:1}),N("span",null,q(a(s))+"%",1),f(t,{content:"缩小",placement:"bottom"},{default:w(()=>[f(i,{icon:a(G),circle:"",disabled:a(s)<=50,onClick:e[1]||(e[1]=n=>s.value-=10)},null,8,["icon","disabled"])]),_:1})]),N("div",oe,[f(H,{node:o.process,onAddNode:S,onDelNode:T,onActiveNode:E},null,8,["node"])]),f(J,{modelValue:a(p),"onUpdate:modelValue":e[2]||(e[2]=n=>k(p)?p.value=n:null),"active-data":a(c),"onUpdate:activeData":e[3]||(e[3]=n=>k(c)?c.value=n:null)},null,8,["modelValue","active-data"])],512)}}}),yo=Q(ie,[["__scopeId","data-v-54b7ad08"]]);export{yo as default};
