
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{g as j}from"./sys_menu-CbQ8rWqJ.js";import{s as q,b as z}from"./sys_role-CiNVMn25.js";import{y as F}from"./index-qeCTDZwl.js";import{a as K}from"./element-plus-iUOJk6xm.js";import{d as X,r as u,l as Y,ai as n,a as G,S as H,U as i,_ as a,Y as k,f as C,k as s,X as L,E as J,n as w}from"./@vue-B5ZJ3lyG.js";import{_ as Q}from"./vue-esign-CYl9_Ryz.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-CyY_Wk_H.js";import"./@imengyu-CEcZjhxx.js";import"./vue-DvVlWPqX.js";import"./floating-vue-AocVffS4.js";import"./@floating-ui-DiM7Jq06.js";import"./vue-m-message-CaZYo5LC.js";import"./overlayscrollbars-DIcyBJd7.js";import"./@iconify-BcJ8VpTk.js";import"./overlayscrollbars-vue-CwvYLriB.js";import"./@headlessui-Cgia3ZxR.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-0jcLrwUI.js";import"./lodash-es-Cgwu3vQX.js";import"./pinia-C6gN_FJk.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-B53joON4.js";import"./hotkeys-js-BfWqkGRU.js";import"./vue-i18n-BoS7Exf_.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-1i8roCpp.js";import"./path-browserify-CaPOtSVJ.js";import"./axios-CRnBnh7r.js";import"./@vueuse-D9pgrdqz.js";import"./nprogress-CK9xi7fq.js";import"./@element-plus-DlsPF3Ud.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-DHZ_rfNz.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";const W={class:"treeMain"},Z={class:"tree-isCheckBox"},ee=X({name:"RoleAuthDrawer",__name:"roleAuthDrawer",setup(te,{expose:D}){const d=u(!1),c=u({title:"角色权限设置"}),o=Y({menuList:[],menuTreeList:[],menuChecked:[],isChecked:!1,isIndeterminate:!1,props:{label:e=>e.meta.title,class:B}}),f=u({roleDateType:"ALL",departmentList:[],depChecked:[],props:{label:e=>e.name}}),x=u({checked:[],props:{label:e=>e.name},dashboardOptions:[]});async function T(){const e=await j({});o.menuList=e.data,o.menuTreeList=F(e.data)}async function N(e){const t=await z({id:e});o.menuChecked=t.data||[],await w(()=>{let l=o.menuChecked||[];o.isChecked=l.length>=o.menuList.length,o.isIndeterminate=l.length>0&&l.length<o.menuList.length})}async function V(e){c.value=Object.assign(c.value,e),d.value=!0,await T(),e.rowData.id&&await N(e.rowData.id)}const r=u();function A(e,{checkedKeys:t}){if(t.includes(e.id)){let l=r.value.getNode(e.id);h(e,!0),v(l)}else h(e,!1);b()}function b(){w(()=>{let t=r.value.getCheckedNodes().map(l=>l.id);o.isChecked=t.length===o.menuList.length,o.isIndeterminate=t.length>0&&t.length<o.menuList.length})}function h(e,t){e&&e.children&&e.children.map(l=>{r.value.setChecked(l.id,t),e.children&&h(l,t)})}function v(e){if(e.parent){for(let t in e)t=="id"&&r.value.setChecked(e,!0);e.parent&&e.id!==0&&v(e.parent)}}function I(){o.isChecked?r.value.setCheckedNodes(o.menuList):r.value.setCheckedKeys([]),b()}function S(){o.menuTreeList=[],o.menuChecked=[],o.menuList=[],o.isIndeterminate=!1,o.isChecked=!1,x.value.checked=[]}async function R(){let e=r.value&&r.value.getCheckedNodes(!1,!0).map(l=>l.id),t={roleId:c.value.rowData.id,menuIdList:e,roleData:{roleDateType:f.value.roleDateType}};await q(t),K.success({message:"操作成功!",showClose:!0,duration:1e3}),await c.value.getTableList,d.value=!1}function B(e,t){if(t.isLeaf)return"";let l=!0;for(const _ in t.childNodes)t.childNodes[_].isLeaf||(l=!1);return l?"penultimate-node":""}return D({acceptParams:V}),(e,t)=>{const l=n("el-checkbox"),_=n("el-divider"),E=n("el-tree"),y=n("el-tab-pane"),p=n("el-option"),U=n("el-select"),M=n("el-form-item"),P=n("el-form"),O=n("el-tabs"),g=n("el-button"),$=n("el-drawer");return G(),H($,{modelValue:s(d),"onUpdate:modelValue":t[3]||(t[3]=m=>J(d)?d.value=m:null),"destroy-on-close":!0,size:"600px",title:`${s(c).title}`,onClosed:S},{footer:i(()=>[a(g,{onClick:t[2]||(t[2]=m=>d.value=!1)},{default:i(()=>t[5]||(t[5]=[k(" 取消 ")])),_:1}),a(g,{type:"primary",onClick:R},{default:i(()=>t[6]||(t[6]=[k(" 确定 ")])),_:1})]),default:i(()=>[C("div",null,[a(O,{"tab-position":"top"},{default:i(()=>[a(y,{label:"菜单权限"},{default:i(()=>[C("div",W,[C("div",Z,[a(l,{modelValue:s(o).isChecked,"onUpdate:modelValue":t[0]||(t[0]=m=>s(o).isChecked=m),indeterminate:s(o).isIndeterminate,onChange:I},{default:i(()=>t[4]||(t[4]=[k(" 全选/反选 ")])),_:1},8,["modelValue","indeterminate"])]),a(_,{"border-style":"dashed"}),a(E,{ref_key:"menuRef",ref:r,"node-key":"id",data:s(o).menuTreeList,props:s(o).props,"check-on-click-node":!0,"check-strictly":!0,"default-checked-keys":s(o).menuChecked,"expand-on-click-node":!1,"highlight-current":"","show-checkbox":"","default-expand-all":"",onCheck:A},null,8,["data","props","default-checked-keys"])])]),_:1}),a(y,{label:"数据权限"},{default:i(()=>[a(P,{"label-width":"100px","label-position":"left"},{default:i(()=>[a(M,{label:"规则类型"},{default:i(()=>[a(U,{modelValue:s(f).roleDateType,"onUpdate:modelValue":t[1]||(t[1]=m=>s(f).roleDateType=m),placeholder:"请选择"},{default:i(()=>[a(p,{label:"全部可见",value:"ALL"}),a(p,{label:"仅部门可见",value:"DEPT"}),a(p,{label:"选择的部门可见",value:"SELECT_DEPT"}),a(p,{label:"仅本人可见",value:"USERSELF"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),L("",!0),L("",!0)]),_:1})])]),_:1},8,["modelValue","title"])}}}),je=Q(ee,[["__scopeId","data-v-97ea0cc1"]]);export{je as default};
