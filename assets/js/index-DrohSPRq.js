
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{d as q,i as M,r as w,b as J,w as Y,a as O,c as z,V as ue,$ as de,k as v,f as C,Z as _e,_ as A,X as le,q as ee,F as G,S as te,U as oe,Q as Se,a2 as we,p as Ce,e as ke,ai as $e,aa as Ne,a8 as ve,s as Re,g as Te,n as he,O as se,N as Be,o as Oe}from"./@vue-B5ZJ3lyG.js";import{G as ae,w as Me,H as Le}from"./@vueuse-D9pgrdqz.js";import{v as Z}from"./index-qeCTDZwl.js";import{u as fe,a as De,f as pe,g as He,_ as Ve,d as ce,c as We,b as ze,e as Ae}from"./index-CN3V1Hei.js";import{_ as ie}from"./icon.vue_vue_type_script_setup_true_lang-Ct1VJFCF.js";import{d as Pe}from"./vuedraggable-CX4WvCQN.js";import"./nprogress-CK9xi7fq.js";import"./@imengyu-CEcZjhxx.js";import"./vue-DvVlWPqX.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-CyY_Wk_H.js";import"./floating-vue-AocVffS4.js";import"./@floating-ui-DiM7Jq06.js";import"./vue-m-message-CaZYo5LC.js";import"./overlayscrollbars-DIcyBJd7.js";import"./@iconify-BcJ8VpTk.js";import"./overlayscrollbars-vue-CwvYLriB.js";import"./@headlessui-Cgia3ZxR.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-0jcLrwUI.js";import"./lodash-es-Cgwu3vQX.js";import"./pinia-C6gN_FJk.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-B53joON4.js";import"./hotkeys-js-BfWqkGRU.js";import"./element-plus-iUOJk6xm.js";import"./@element-plus-DlsPF3Ud.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-DHZ_rfNz.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./vue-i18n-BoS7Exf_.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-1i8roCpp.js";import"./path-browserify-CaPOtSVJ.js";import"./axios-CRnBnh7r.js";import"./vue-esign-CYl9_Ryz.js";import"./sortablejs-BWWsmqBL.js";function Fe(F,i){let c=null;return(...p)=>{c&&clearTimeout(c),c=setTimeout(()=>{F(...p)},i)}}const Ue={class:"elegant-widget-action-item whitespace-nowrap"},Ee={key:0,class:"flex items-center"},Ie=q({__name:"previewWidgets",setup(F,{expose:i}){const c=M("pageManager",{}),p=M("pageSchema"),a=M("designer"),m=M("designerProps"),g=M("revoke"),u=w(null),k=w(null),b=w(null),H=w(!1),L=w(!1),e=w(!0),s=w("top"),{canvasScale:l,disabledZoom:f}=fe();let o=null;const V=J(()=>{const t=a.state.checkedNode;return!(!(t!=null&&t.id)||m.value.lockDefaultSchemaEdit&&c.defaultComponentIds.value.includes(t==null?void 0:t.id))}),W=J(()=>{var $,N,T,d,P,j;const t=c.componentInstances.value,r=($=a.state.checkedNode)==null?void 0:$.id;if((T=(N=a.state.checkedNode)==null?void 0:N.componentProps)!=null&&T.hidden)return null;const S=Z.getComponentConfingByType((d=a.state.checkedNode)==null?void 0:d.type)??null;if(!r||!(t!=null&&t[r]))return null;if(S!=null&&S.defaultSchema.input&&((P=a.state.checkedNode)==null?void 0:P.noFormItem)!==!0)return(j=t[`${r}formItem`])==null?void 0:j.$el;const n=t[r];return!(n!=null&&n.$el)||(n==null?void 0:n.$el.nodeName)==="#text"||!(n!=null&&n.$el.getBoundingClientRect)?null:n==null?void 0:n.$el}),R=J(()=>{var $,N,T,d;const t=c.componentInstances.value,r=($=a.state.hoverNode)==null?void 0:$.id,S=Z.getComponentConfingByType((N=a.state.hoverNode)==null?void 0:N.type)??null;if(!r||!(t!=null&&t[r]))return null;if(S!=null&&S.defaultSchema.input&&((T=a.state.hoverNode)==null?void 0:T.noFormItem)!==!0)return(d=t[`${r}formItem`])==null?void 0:d.$el;const n=t[r];return(n==null?void 0:n.$el.nodeName)==="#text"?null:n==null?void 0:n.$el}),{mutationObserver:Q,observerConfig:x}=me(E),{startTimedQuery:y,stopTimedQuery:_}=De(E);Y(()=>W.value,t=>{if(t){H.value=!0,Q.observe(t,x);const r=t.parentNode;r&&(r.ondragstart=()=>{e.value=!1,y()},r.ondragend=()=>{e.value=!0,_()}),E()}else H.value=!1});const{mutationObserver:U,observerConfig:D}=me(re);Y(()=>R.value,t=>{t&&(U.observe(t,D),re())});let h=0;Y(()=>{var t;return(t=a.state.hoverNode)==null?void 0:t.id},t=>{if(t){L.value=!0,clearTimeout(h);return}h=setTimeout(()=>{L.value=!1},300)});let B=0,I=0;function E(){const t=W.value;if(!t||!o)return;const{top:r,left:S}=o==null?void 0:o.getBoundingClientRect(),{top:n,left:$,width:N,height:T}=t.getBoundingClientRect(),d=f.value?1:l.value,P=n-r+((o==null?void 0:o.scrollTop)??0)*d,j=$-S+((o==null?void 0:o.scrollLeft)??0)*d,K=T/d;u.value&&(u.value.style.width=`${N/d}px`,u.value.style.height=`${K}px`,u.value.style.top=`${P/d}px`,u.value.style.left=`${j/d}px`,X(P,j)),b.value&&(P<45&&K<100?(b.value.style.top="",b.value.style.bottom="-30px",b.value.style.borderRadius="0px 0px 4px 4px",s.value="bottom"):P<45?(b.value.style.top="0px",b.value.style.borderRadius="0px 0px 4px 0",s.value="center"):(b.value.style.top="-30px",b.value.style.borderRadius="4px 4px 0px 0px",s.value="top"))}function X(t,r){const S=W.value;if(!o||!S)return;const n=o.getBoundingClientRect(),{width:$}=S.getBoundingClientRect(),N=f.value?1:l.value,T=t/N-n.top;let d=r/N-n.left+$/N;d<n.width&&(d=0);const P=o.scrollTop-n.height/3+60,j=o.scrollTop+n.height/3*2,K=o.scrollLeft-n.width+200,ne=o.scrollLeft+n.width-200;Math.abs(T-B)<10&&Math.abs(d-I)<10||(B=T,I=d,!(T>P&&T<j&&d>K&&d<ne)&&(o.scrollTop=T,o.scrollLeft=d))}function re(){var K,ne;const t=R.value;if(!t)return;const{top:r,left:S}=(o==null?void 0:o.getBoundingClientRect())??{top:0,left:0},{top:n,left:$,width:N,height:T}=((K=t.getBoundingClientRect)==null?void 0:K.call(t))??((ne=t.nextElementSibling)==null?void 0:ne.getBoundingClientRect()),d=f.value?1:l.value,P=n-r+((o==null?void 0:o.scrollTop)??0)*d,j=$-S+((o==null?void 0:o.scrollLeft)??0)*d;k.value&&(k.value.style.width=`${N/d}px`,k.value.style.height=`${T/d}px`,k.value.style.top=`${P/d}px`,k.value.style.left=`${j/d}px`)}function me(t){const r=window.MutationObserver,S={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new r(t),observerConfig:S}}function xe(){var N;const t=pe(p.schemas,((N=a.state.checkedNode)==null?void 0:N.id)??"root");if(!t)return!1;const{list:r,schema:S,index:n}=t,$=He(S);r.splice(n+1,0,$),a.setCheckedNode($),g.push(p.schemas,"复制组件")}function ye(){var $;const t=pe(p.schemas,(($=a.state.checkedNode)==null?void 0:$.id)??"root");if(!t)return!1;let{list:r,schema:S,index:n}=t;r.splice(n,1),n===r.length&&n--,a.setCheckedNode(r[n]),g.push(p.schemas,"删除组件")}function be(t){o=t,o==null||o.addEventListener("scroll",()=>{E()}),ae(W,E),ae(R,re)}return i({handleInit:be}),(t,r)=>{var S,n,$,N,T;return O(),z(G,null,[ue(C("div",{ref_key:"selectorRef",ref:u,class:ee(["elegant-checked-widget pointer-events-none absolute z-20",`${s.value} ${e.value?"transition-all":""}`])},[C("div",{ref_key:"actionBoxRef",ref:b,class:"elegant-widget-action-box"},[C("div",Ue,_e((n=v(Z).getComponentConfingByType(((S=v(a).state.checkedNode)==null?void 0:S.type)??""))==null?void 0:n.defaultSchema.label),1),V.value?(O(),z("div",Ee,[C("div",{title:"复制",class:"elegant-widget-action-item pointer-events-auto",onClick:xe},[A(v(ie),{name:"icon--elegant--copy-all-outline-rounded"})]),C("div",{title:"删除",class:"elegant-widget-action-item pointer-events-auto",onClick:ye},[A(v(ie),{name:"icon--elegant--delete-outline-rounded"})])])):le("",!0)],512)],2),[[de,H.value&&(($=v(a).state.checkedNode)==null?void 0:$.id)!=="root"]]),ue(C("div",{ref_key:"hoverWidgetRef",ref:k,class:"elegant-hover-widget pointer-events-none absolute z-998 transition-all"},null,512),[[de,L.value&&((N=v(a).state.checkedNode)==null?void 0:N.id)!==((T=v(a).state.hoverNode)==null?void 0:T.id)]])],64)}}}),je=q({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(F,{emit:i}){const c=F,p=i,a=M("designer"),m=M("pageSchema"),g=M("revoke"),u=J({get(){return c.schemas},set(e){p("update:schemas",e)}});function k(e){a.setCheckedNode(u.value[e]),a.setDisableHover(!0)}function b(){a.setDisableHover(),g.push(m.schemas,"拖拽组件")}function H(){g.push(m.schemas,"插入组件")}function L(e){var s,l,f;return e.id===((s=m.schemas[0])==null?void 0:s.id)||(f=(l=Z.getComponentConfingByType(e.type))==null?void 0:l.editConstraints)!=null&&f.immovable?"unmover-item":"draggable-item"}return(e,s)=>(O(),te(v(Pe),Se({modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=l=>u.value=l),"item-key":"id","component-data":{type:"transition-group"},class:"elegant-draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:s[1]||(s[1]=l=>k(l.oldIndex)),onEnd:s[2]||(s[2]=l=>b()),onAdd:s[3]||(s[3]=l=>{k(l.newIndex),H()})}),{item:oe(({element:l,index:f})=>[(O(),z("div",{key:f,class:ee(["widget-box",L(l)])},[A(ge,{schema:l},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),ge=q({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(F){const i=F,c=we(),p=M("designer"),a=M("pageManager",{}),m=M("pageSchema",{}),g=w(null);Ce("nodeAttrs",c);const u=J(()=>{var o,V,W,R,Q;const e=a.componentInstances.value,s=(o=i.schema)==null?void 0:o.id,l=Z.getComponentConfingByType((V=i.schema)==null?void 0:V.type)??null;if(!s||!(e!=null&&e[s]))return null;if(l!=null&&l.defaultSchema.input&&((W=i.schema)==null?void 0:W.noFormItem)!==!0)return(R=e[`${s}formItem`])==null?void 0:R.$el;const f=e[s];return((Q=f==null?void 0:f.$el)==null?void 0:Q.nodeName)==="#text"?null:f==null?void 0:f.$el});Y(()=>u.value,e=>{e==null||e.addEventListener("click",k,!1),e==null||e.addEventListener("mouseover",b,!1),e==null||e.addEventListener("mouseout",H,!1)}),ke(()=>{var e,s,l;(e=u.value)==null||e.removeEventListener("click",k,!1),(s=u.value)==null||s.removeEventListener("mouseover",b,!1),(l=u.value)==null||l.removeEventListener("mouseout",H,!1)});function k(e){e.stopPropagation(),p.setCheckedNode(i.schema)}function b(e){var s;i.schema.id!==((s=m.schemas[0])==null?void 0:s.id)&&(e.stopPropagation(),p.setHoverNode(i.schema))}function H(e){e.stopPropagation(),p.setHoverNode(null)}const L=w(i.schema);return Y(()=>i.schema,e=>{L.value=e},{deep:!0}),(e,s)=>{var f,o;const l=$e("ENodeItem");return O(),te(v(Ve),{ref_key:"nodeRef",ref:g,"component-schema":i.schema},Ne({_:2},[(o=(f=v(Z).getComponentConfingByType(i.schema.type))==null?void 0:f.editConstraints)!=null&&o.childImmovable?{name:"edit-node",fn:oe(()=>[(O(!0),z(G,null,ve(i.schema.children,V=>(O(),te(l,{key:V.id,schema:V},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:oe(()=>[i.schema.children?(O(),te(je,{key:0,schemas:L.value.children,"onUpdate:schemas":s[0]||(s[0]=V=>L.value.children=V)},null,8,["schemas"])):le("",!0)]),key:"1"}]),1032,["component-schema"])}}}),Je={class:"h-full min-w-750px rounded"},Ze=q({__name:"previewJson",setup(F,{expose:i}){const c=Z.getComponent("modal"),p=Z.getComponent("monacoEditor"),a={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1},readOnly:!0},m=w(null),g=w(!1),u=M("pageSchema");function k(){g.value=!1}function b(){g.value=!0,m.value?m.value.setValue(JSON.stringify(u,null,2)):setTimeout(()=>{b()},300)}function H(L="elegant-data.json"){const e=JSON.stringify(u,null,2);let s=`data:text/json;charset=utf-8,${encodeURIComponent(e)}`,l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download",L),l.click()}return i({handleOpen:b}),(L,e)=>(O(),te(v(c),{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),title:"查看数据",class:"w-900px",width:"900px","ok-text":"导出数据",onClose:k,onOk:H},{default:oe(()=>[C("div",Je,[A(v(p),{ref_key:"monacoEditorRef",ref:m,class:"editor h-full","auto-toggle-theme":"","read-only":"",config:a,language:"json"},null,512)])]),_:1},8,["modelValue"]))}}),Qe={class:"elegant-edit-toolbar flex items-center justify-between px-2"},Xe={class:"h-full flex flex-1 items-center"},Ke={key:0,class:"elegant-divider"},Ye=["title","onClick"],qe={class:"h-full flex flex-1 items-center justify-end"},Ge={key:0,class:"ml-12px flex items-center"},et={class:"w-82px cursor-pointer pr-8px"},tt={class:"elegant-device h-28px flex items-center gap-1 border rounded-md p-2px"},ot=["title","onClick"],nt=q({__name:"toolbar",setup(F){const i=Z.getComponent("select"),{canvasScale:c,disabledZoom:p}=fe(),a=w("pc"),m=M("pageSchema"),g=M("designer"),u=M("revoke"),k=w(null),b=[{icon:"icon--elegant--computer-outline-rounded",title:"pc",key:"pc"},{icon:"icon--elegant--tablet-android-outline-rounded",title:"平板",key:"pad"},{icon:"icon--elegant--phone-iphone-outline-sharp",title:"手机",key:"mobile"}],H=J(()=>[{icon:"icon--elegant--code",title:"查看数据",on:()=>V()},{icon:"icon--elegant--trash",title:"清空",on:o},{icon:"icon--elegant--undo",title:"撤销",on:l,disabled:!u.recordList.value.length,divider:!0},{icon:"icon--elegant--redo",title:"重做",on:f,disabled:!u.undoList.value.length}]),L=w(null),e=J({get(){return`${(c.value*100).toFixed(0)}%`},set(x){const y=Number.parseFloat(x);c.value=y/100}}),s=[{label:"60%",value:"60%"},{label:"80%",value:"80%"},{label:"100%",value:"100%"},{label:"120%",value:"120%"},{label:"140%",value:"140%"}];function l(){const x=u.undo();x&&(ce(m.schemas,x),g.setCheckedNode(m.schemas[0]))}function f(){const x=u.redo();x&&(ce(m.schemas,x),g.setCheckedNode(m.schemas[0]))}function o(){g.reset()}function V(){k.value.handleOpen()}function W(x){var U;const y=(U=x.target.files)==null?void 0:U[0];if(!y)return;x.target.value=null;const _=new FileReader;_.readAsText(y),_.onload=D=>{var h;R((h=D.target)==null?void 0:h.result)}}function R(x){try{let y=JSON.parse(x??"");y.schemas||(y=We(y)),ce(m,y)}catch{}}function Q(x){g.handleToggleDeviceMode(x),a.value=x;const y={pc:{},pad:{width:"780px",mode:x},mobile:{width:"390px",mode:x}};m.canvas=y[x]}return(x,y)=>(O(),z(G,null,[C("div",Qe,[C("div",Xe,[(O(!0),z(G,null,ve(H.value,(_,U)=>(O(),z(G,{key:U},[_.divider?(O(),z("div",Ke)):le("",!0),C("div",{title:_.title,class:ee(["elegant-action-item h-90% flex cursor-pointer items-center px-10px text-base",{disabled:_.disabled}]),onClick:_.on},[A(v(ie),{name:_.icon},null,8,["name"])],10,Ye)],64))),128))]),ue(C("input",{ref_key:"fileRef",ref:L,type:"file",accept:".json,.txt",onChange:W},null,544),[[de,!1]]),C("div",qe,[v(p)?le("",!0):(O(),z("div",Ge,[C("div",et,[A(v(i),{value:e.value,"onUpdate:value":y[0]||(y[0]=_=>e.value=_),modelValue:e.value,"onUpdate:modelValue":y[1]||(y[1]=_=>e.value=_),options:s,size:"small"},null,8,["value","modelValue"])])])),C("div",tt,[(O(),z(G,null,ve(b,_=>C("div",{key:_.key,title:_.title,class:ee(["elegant-device-item h-full flex cursor-pointer items-center rounded-sm px-1 text-base transition-colors",{checked:_.key===a.value}]),onClick:U=>Q(_.key)},[A(v(ie),{name:_.icon},null,8,["name"])],10,ot)),64))])])]),A(Ze,{ref_key:"previewJson",ref:k},null,512)],64))}}),st={class:"relative h-full flex flex-col"},lt=["draggable"],at=q({__name:"editScreenContainer",setup(F){const i=M("pageSchema"),c=w(null),p=w(null),a=w(null),{pressSpace:m,disabledZoom:g}=fe(),{handleElementDragStart:u,handleElementDrag:k,handleElementDragEnd:b}=ze(c),{width:H,height:L}=Me(c),{canvasScale:e,handleZoom:s}=Ae(p);let l=0,f=0;const o=w({}),V=w({}),W=w({}),R=Re({width:0,height:0});Te(x),Y(W,()=>{he(Q)});function Q(){a.value&&(R.value={width:a.value.clientWidth,height:a.value.clientHeight})}function x(){var D,h;W.value={width:((D=i.canvas)==null?void 0:D.width)??"0",height:((h=i.canvas)==null?void 0:h.height)??"0"}}Le(H,y),Y(R,y);function y(){let D=R.value.width||l,h=R.value.height||f;o.value={width:`${H.value+D}px`,height:`${L.value+h}px`},V.value={width:`${D}px`,height:`${h}px`},_()}function _(){he(()=>{var E;let D=R.value.width||l;const B=(R.value.height||f)/2,I=D/2;(E=c.value)==null||E.scrollTo(I,B)})}ae(c,U),ae(p,U);function U(){var h;if(!c.value)return;const D=c.value.getBoundingClientRect();if(l=D.width-60,f=D.height-80,!g.value)if(R.value.width===0)e.value=1;else{const B=(l-20)/R.value.width,I=f/(R.value.height||((h=p.value)==null?void 0:h.clientHeight)||1),E=Math.abs(B-1)<Math.abs(I-1);let X=1;E?X=B:X=I,(B<1||I<1)&&(X=Math.min(B,I)),X<1.4&&X>.5&&(e.value=X)}Fe(y,50)()}return(D,h)=>(O(),z("div",st,[A(nt),C("div",{ref_key:"editScreenContainerRef",ref:c,class:ee(["elegant-edit-screen-container flex-1 overflow-auto overflow-y-hidden",{"cursor-grab":v(m)}]),draggable:v(m),onWheel:h[0]||(h[0]=(...B)=>v(s)&&v(s)(...B)),onDragstart:h[1]||(h[1]=(...B)=>v(u)&&v(u)(...B)),onDragend:h[2]||(h[2]=(...B)=>v(b)&&v(b)(...B)),onDrag:h[3]||(h[3]=(...B)=>v(k)&&v(k)(...B))},[C("div",{id:"canvasContainer",class:"flex items-center justify-center",style:se(o.value)},[C("div",{ref_key:"draggableElRef",ref:p,class:"transition-all"},[C("div",{class:ee({"pointer-events-none":v(m)}),style:se(V.value)},[Be(D.$slots,"default")],6)],512)],4)],42,lt),C("div",{ref_key:"sizeBoxRef",ref:a,class:"pointer-events-none absolute top-0",style:se(W.value)},null,4)]))}}),it={class:"elegant-edit-canvas"},Xt=q({__name:"index",setup(F){const i=w(null),c=w(null),p=M("pageSchema"),a=J(()=>p.schemas[0]),m=J(()=>({width:"100%",height:"100%"}));return Oe(()=>{var g;(g=c.value)==null||g.handleInit(i.value)}),(g,u)=>(O(),z("section",it,[A(at,null,{default:oe(()=>[C("div",{ref_key:"elegantEditRangeRef",ref:i,class:"elegant-edit-range relative overflow-auto rounded-md",style:se(m.value)},[A(ge,{schema:a.value},null,8,["schema"]),A(Ie,{ref_key:"ePreviewWidgetsRef",ref:c},null,512)],4)]),_:1})]))}});export{Xt as default};
